<svg viewBox="0 0 1200 600" xmlns="http://www.w3.org/2000/svg">
  <!-- Background -->
  <rect width="1200" height="600" fill="#ffffff"/>
  
  <!-- Title -->
  <text x="600" y="40" text-anchor="middle" font-family="Arial, sans-serif" font-size="24" font-weight="bold" fill="#2c3e50">
    ClickHouse Data Views: System vs Application
  </text>
  
  <!-- System View Section -->
  <g id="system-view">
    <!-- System View Background -->
    <rect x="50" y="80" width="550" height="460" fill="#e8f4fd" stroke="#3498db" stroke-width="3" rx="10"/>
    
    <!-- System View Title -->
    <text x="325" y="110" text-anchor="middle" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#2980b9">
      System View (Raw Data Access)
    </text>
    <text x="325" y="135" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" fill="#34495e">
      Sees ALL data including internal metadata
    </text>
    
    <!-- Products Table - System View -->
    <rect x="70" y="160" width="510" height="250" fill="#ffffff" stroke="#3498db" stroke-width="2" rx="5"/>
    <text x="325" y="185" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#2980b9">
      products_table (Raw Storage)
    </text>
    
    <!-- Table Header -->
    <rect x="80" y="200" width="490" height="25" fill="#3498db" stroke="#2980b9" stroke-width="1"/>
    <text x="90" y="217" font-family="Courier, monospace" font-size="10" font-weight="bold" fill="white">id</text>
    <text x="140" y="217" font-family="Courier, monospace" font-size="10" font-weight="bold" fill="white">name</text>
    <text x="240" y="217" font-family="Courier, monospace" font-size="10" font-weight="bold" fill="white">price</text>
    <text x="300" y="217" font-family="Courier, monospace" font-size="10" font-weight="bold" fill="white">_part_id</text>
    <text x="370" y="217" font-family="Courier, monospace" font-size="10" font-weight="bold" fill="white">_level</text>
    <text x="420" y="217" font-family="Courier, monospace" font-size="10" font-weight="bold" fill="white">_state</text>
    <text x="480" y="217" font-family="Courier, monospace" font-size="10" font-weight="bold" fill="white">_version</text>
    
    <!-- Data Rows - Including duplicates and deleted -->
    <rect x="80" y="225" width="490" height="20" fill="#ffebee" stroke="#ffcdd2" stroke-width="0.5"/>
    <text x="90" y="238" font-family="Courier, monospace" font-size="9" fill="#2c3e50">101</text>
    <text x="140" y="238" font-family="Courier, monospace" font-size="9" fill="#2c3e50">Laptop Pro</text>
    <text x="240" y="238" font-family="Courier, monospace" font-size="9" fill="#2c3e50">1299.99</text>
    <text x="300" y="238" font-family="Courier, monospace" font-size="9" fill="#e74c3c">20241201_1</text>
    <text x="370" y="238" font-family="Courier, monospace" font-size="9" fill="#e74c3c">0</text>
    <text x="420" y="238" font-family="Courier, monospace" font-size="9" fill="#e74c3c">DELETED</text>
    <text x="480" y="238" font-family="Courier, monospace" font-size="9" fill="#e74c3c">1</text>
    
    <rect x="80" y="245" width="490" height="20" fill="#e8f5e8" stroke="#c8e6c9" stroke-width="0.5"/>
    <text x="90" y="258" font-family="Courier, monospace" font-size="9" fill="#2c3e50">101</text>
    <text x="140" y="258" font-family="Courier, monospace" font-size="9" fill="#2c3e50">Laptop Pro</text>
    <text x="240" y="258" font-family="Courier, monospace" font-size="9" fill="#2c3e50">1199.99</text>
    <text x="300" y="258" font-family="Courier, monospace" font-size="9" fill="#27ae60">20241205_1</text>
    <text x="370" y="258" font-family="Courier, monospace" font-size="9" fill="#27ae60">0</text>
    <text x="420" y="258" font-family="Courier, monospace" font-size="9" fill="#27ae60">ACTIVE</text>
    <text x="480" y="258" font-family="Courier, monospace" font-size="9" fill="#27ae60">2</text>
    
    <rect x="80" y="265" width="490" height="20" fill="#fff3e0" stroke="#ffcc02" stroke-width="0.5"/>
    <text x="90" y="278" font-family="Courier, monospace" font-size="9" fill="#2c3e50">102</text>
    <text x="140" y="278" font-family="Courier, monospace" font-size="9" fill="#2c3e50">Mouse</text>
    <text x="240" y="278" font-family="Courier, monospace" font-size="9" fill="#2c3e50">29.99</text>
    <text x="300" y="278" font-family="Courier, monospace" font-size="9" fill="#f39c12">20241203_1</text>
    <text x="370" y="278" font-family="Courier, monospace" font-size="9" fill="#f39c12">0</text>
    <text x="420" y="278" font-family="Courier, monospace" font-size="9" fill="#f39c12">PENDING</text>
    <text x="480" y="278" font-family="Courier, monospace" font-size="9" fill="#f39c12">1</text>
    
    <rect x="80" y="285" width="490" height="20" fill="#e8f5e8" stroke="#c8e6c9" stroke-width="0.5"/>
    <text x="90" y="298" font-family="Courier, monospace" font-size="9" fill="#2c3e50">103</text>
    <text x="140" y="298" font-family="Courier, monospace" font-size="9" fill="#2c3e50">Keyboard</text>
    <text x="240" y="298" font-family="Courier, monospace" font-size="9" fill="#2c3e50">79.99</text>
    <text x="300" y="298" font-family="Courier, monospace" font-size="9" fill="#27ae60">20241204_1</text>
    <text x="370" y="298" font-family="Courier, monospace" font-size="9" fill="#27ae60">0</text>
    <text x="420" y="298" font-family="Courier, monospace" font-size="9" fill="#27ae60">ACTIVE</text>
    <text x="480" y="298" font-family="Courier, monospace" font-size="9" fill="#27ae60">1</text>
    
    <rect x="80" y="305" width="490" height="20" fill="#ffebee" stroke="#ffcdd2" stroke-width="0.5"/>
    <text x="90" y="318" font-family="Courier, monospace" font-size="9" fill="#2c3e50">104</text>
    <text x="140" y="318" font-family="Courier, monospace" font-size="9" fill="#2c3e50">Monitor</text>
    <text x="240" y="318" font-family="Courier, monospace" font-size="9" fill="#2c3e50">299.99</text>
    <text x="300" y="318" font-family="Courier, monospace" font-size="9" fill="#e74c3c">20241130_1</text>
    <text x="370" y="318" font-family="Courier, monospace" font-size="9" fill="#e74c3c">0</text>
    <text x="420" y="318" font-family="Courier, monospace" font-size="9" fill="#e74c3c">DELETED</text>
    <text x="480" y="318" font-family="Courier, monospace" font-size="9" fill="#e74c3c">1</text>
    
    <rect x="80" y="325" width="490" height="20" fill="#e8f5e8" stroke="#c8e6c9" stroke-width="0.5"/>
    <text x="90" y="338" font-family="Courier, monospace" font-size="9" fill="#2c3e50">105</text>
    <text x="140" y="338" font-family="Courier, monospace" font-size="9" fill="#2c3e50">Webcam</text>
    <text x="240" y="338" font-family="Courier, monospace" font-size="9" fill="#2c3e50">149.99</text>
    <text x="300" y="338" font-family="Courier, monospace" font-size="9" fill="#27ae60">20241206_1</text>
    <text x="370" y="338" font-family="Courier, monospace" font-size="9" fill="#27ae60">0</text>
    <text x="420" y="338" font-family="Courier, monospace" font-size="9" fill="#27ae60">ACTIVE</text>
    <text x="480" y="338" font-family="Courier, monospace" font-size="9" fill="#27ae60">1</text>
    
    <rect x="80" y="345" width="490" height="20" fill="#fff3e0" stroke="#ffcc02" stroke-width="0.5"/>
    <text x="90" y="358" font-family="Courier, monospace" font-size="9" fill="#2c3e50">106</text>
    <text x="140" y="358" font-family="Courier, monospace" font-size="9" fill="#2c3e50">Headphones</text>
    <text x="240" y="358" font-family="Courier, monospace" font-size="9" fill="#2c3e50">199.99</text>
    <text x="300" y="358" font-family="Courier, monospace" font-size="9" fill="#f39c12">20241207_1</text>
    <text x="370" y="358" font-family="Courier, monospace" font-size="9" fill="#f39c12">0</text>
    <text x="420" y="358" font-family="Courier, monospace" font-size="9" fill="#f39c12">PENDING</text>
    <text x="480" y="358" font-family="Courier, monospace" font-size="9" fill="#f39c12">1</text>
    
    <rect x="80" y="365" width="490" height="20" fill="#e8f5e8" stroke="#c8e6c9" stroke-width="0.5"/>
    <text x="90" y="378" font-family="Courier, monospace" font-size="9" fill="#2c3e50">107</text>
    <text x="140" y="378" font-family="Courier, monospace" font-size="9" fill="#2c3e50">Tablet</text>
    <text x="240" y="378" font-family="Courier, monospace" font-size="9" fill="#2c3e50">599.99</text>
    <text x="300" y="378" font-family="Courier, monospace" font-size="9" fill="#27ae60">20241208_1</text>
    <text x="370" y="378" font-family="Courier, monospace" font-size="9" fill="#27ae60">0</text>
    <text x="420" y="378" font-family="Courier, monospace" font-size="9" fill="#27ae60">ACTIVE</text>
    <text x="480" y="378" font-family="Courier, monospace" font-size="9" fill="#27ae60">1</text>
    
    <!-- System View Summary -->
    <rect x="70" y="430" width="510" height="90" fill="#d5dbdb" stroke="#85929e" stroke-width="1" rx="5"/>
    <text x="325" y="450" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#2c3e50">
      System View Summary
    </text>
    <text x="80" y="470" font-family="Arial, sans-serif" font-size="12" fill="#2c3e50">
      â€¢ Total rows: 8 (includes all states and versions)
    </text>
    <text x="80" y="485" font-family="Arial, sans-serif" font-size="12" fill="#2c3e50">
      â€¢ Shows: Internal metadata (_part_id, _level, _state, _version)
    </text>
    <text x="80" y="500" font-family="Arial, sans-serif" font-size="12" fill="#2c3e50">
      â€¢ Includes: ACTIVE, PENDING, DELETED states
    </text>
    <text x="80" y="515" font-family="Arial, sans-serif" font-size="12" fill="#2c3e50">
      â€¢ Purpose: Administration, debugging, full data access
    </text>
  </g>
  
  <!-- Application View Section -->
  <g id="application-view">
    <!-- Application View Background -->
    <rect x="650" y="80" width="500" height="460" fill="#fdf2e9" stroke="#e67e22" stroke-width="3" rx="10"/>
    
    <!-- Application View Title -->
    <text x="900" y="110" text-anchor="middle" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#d35400">
      Application View (Filtered by Engine)
    </text>
    <text x="900" y="135" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" fill="#34495e">
      Sees only ACTIVE data, engine-filtered
    </text>
    
    <!-- Products Table - Application View -->
    <rect x="670" y="160" width="460" height="180" fill="#ffffff" stroke="#e67e22" stroke-width="2" rx="5"/>
    <text x="900" y="185" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#d35400">
      products_table (Application View)
    </text>
    
    <!-- Table Header -->
    <rect x="680" y="200" width="440" height="25" fill="#e67e22" stroke="#d35400" stroke-width="1"/>
    <text x="690" y="217" font-family="Courier, monospace" font-size="10" font-weight="bold" fill="white">product_id</text>
    <text x="780" y="217" font-family="Courier, monospace" font-size="10" font-weight="bold" fill="white">product_name</text>
    <text x="920" y="217" font-family="Courier, monospace" font-size="10" font-weight="bold" fill="white">price</text>
    <text x="1000" y="217" font-family="Courier, monospace" font-size="10" font-weight="bold" fill="white">status</text>
    
    <!-- Clean Data Rows - Only ACTIVE -->
    <rect x="680" y="225" width="440" height="20" fill="#d5f4e6" stroke="#82e5aa" stroke-width="0.5"/>
    <text x="690" y="238" font-family="Courier, monospace" font-size="9" fill="#2c3e50">101</text>
    <text x="780" y="238" font-family="Courier, monospace" font-size="9" fill="#2c3e50">Laptop Pro</text>
    <text x="920" y="238" font-family="Courier, monospace" font-size="9" fill="#2c3e50">1199.99</text>
    <text x="1000" y="238" font-family="Courier, monospace" font-size="9" fill="#27ae60">Active</text>
    
    <rect x="680" y="245" width="440" height="20" fill="#d5f4e6" stroke="#82e5aa" stroke-width="0.5"/>
    <text x="690" y="258" font-family="Courier, monospace" font-size="9" fill="#2c3e50">103</text>
    <text x="780" y="258" font-family="Courier, monospace" font-size="9" fill="#2c3e50">Keyboard</text>
    <text x="920" y="258" font-family="Courier, monospace" font-size="9" fill="#2c3e50">79.99</text>
    <text x="1000" y="258" font-family="Courier, monospace" font-size="9" fill="#27ae60">Active</text>
    
    <rect x="680" y="265" width="440" height="20" fill="#d5f4e6" stroke="#82e5aa" stroke-width="0.5"/>
    <text x="690" y="278" font-family="Courier, monospace" font-size="9" fill="#2c3e50">105</text>
    <text x="780" y="278" font-family="Courier, monospace" font-size="9" fill="#2c3e50">Webcam</text>
    <text x="920" y="278" font-family="Courier, monospace" font-size="9" fill="#2c3e50">149.99</text>
    <text x="1000" y="278" font-family="Courier, monospace" font-size="9" fill="#27ae60">Active</text>
    
    <rect x="680" y="285" width="440" height="20" fill="#d5f4e6" stroke="#82e5aa" stroke-width="0.5"/>
    <text x="690" y="298" font-family="Courier, monospace" font-size="9" fill="#2c3e50">107</text>
    <text x="780" y="298" font-family="Courier, monospace" font-size="9" fill="#2c3e50">Tablet</text>
    <text x="920" y="298" font-family="Courier, monospace" font-size="9" fill="#2c3e50">599.99</text>
    <text x="1000" y="298" font-family="Courier, monospace" font-size="9" fill="#27ae60">Active</text>
    
    <!-- Engine Filter Explanation -->
    <rect x="670" y="360" width="460" height="70" fill="#f8d7da" stroke="#f5c6cb" stroke-width="1" rx="5"/>
    <text x="900" y="380" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#721c24">
      ðŸš« Engine Filtering in Action
    </text>
    <text x="680" y="400" font-family="Arial, sans-serif" font-size="12" fill="#721c24">
      â€¢ DELETED rows (101 old, 104): Hidden by MergeTree engine
    </text>
    <text x="680" y="415" font-family="Arial, sans-serif" font-size="12" fill="#721c24">
      â€¢ PENDING rows (102, 106): Hidden until state becomes ACTIVE
    </text>
    <text x="680" y="430" font-family="Arial, sans-serif" font-size="12" fill="#721c24">
      â€¢ Internal columns (_part_id, _level, etc.): Not exposed to applications
    </text>
    
    <!-- Application View Summary -->
    <rect x="670" y="450" width="460" height="70" fill="#d5dbdb" stroke="#85929e" stroke-width="1" rx="5"/>
    <text x="900" y="470" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#2c3e50">
      Application View Summary
    </text>
    <text x="680" y="490" font-family="Arial, sans-serif" font-size="12" fill="#2c3e50">
      â€¢ Total rows: 4 (only ACTIVE records visible)
    </text>
    <text x="680" y="505" font-family="Arial, sans-serif" font-size="12" fill="#2c3e50">
      â€¢ Shows: Business columns only (no internal metadata)
    </text>
  </g>
  
  <!-- Data Flow Arrow -->
  <g id="data-flow">
    <defs>
      <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
        <polygon points="0 0, 10 3.5, 0 7" fill="#34495e"/>
      </marker>
    </defs>
    
    <path d="M 600 280 Q 625 250 650 280" stroke="#34495e" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
    <text x="625" y="245" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#34495e">
      Engine Filters
    </text>
    <text x="625" y="260" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#34495e">
      &amp; Abstracts
    </text>
  </g>
  
  <!-- Legend -->
  <g id="legend">
    <rect x="50" y="560" width="1100" height="30" fill="#ecf0f1" stroke="#bdc3c7" stroke-width="1" rx="5"/>
    <text x="70" y="575" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#2c3e50">
      Engine Filtering: System View (8 rows, all states) â†’ Application View (4 rows, ACTIVE only) | MergeTree engine hides DELETED/PENDING + internal metadata
    </text>
    <text x="70" y="585" font-family="Arial, sans-serif" font-size="10" fill="#e74c3c">
      ðŸŸ© ACTIVE ðŸŸ¨ PENDING ðŸŸ¥ DELETED (System sees all, Applications see green only)
    </text>
  </g>
</svg>