<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1400 800" font-family="Arial, sans-serif">
  <!-- Background -->
  <rect width="1400" height="800" fill="#f8f9fa"/>
  
  <!-- Title -->
  <text x="700" y="40" font-size="28" font-weight="bold" text-anchor="middle" fill="#2c3e50">Window Functions: Data Transformation</text>
  
  <!-- Original Data Table -->
  <rect x="50" y="80" width="600" height="300" rx="8" fill="#ffffff" stroke="#34495e" stroke-width="2"/>
  <text x="350" y="105" font-size="18" font-weight="bold" text-anchor="middle" fill="#2c3e50">Original Data</text>
  
  <!-- Table Headers -->
  <rect x="70" y="120" width="120" height="30" fill="#3498db" stroke="#2980b9"/>
  <text x="130" y="140" font-size="12" font-weight="bold" text-anchor="middle" fill="white">currency</text>
  
  <rect x="190" y="120" width="150" height="30" fill="#3498db" stroke="#2980b9"/>
  <text x="265" y="140" font-size="12" font-weight="bold" text-anchor="middle" fill="white">uploaded_at</text>
  
  <rect x="340" y="120" width="120" height="30" fill="#3498db" stroke="#2980b9"/>
  <text x="400" y="140" font-size="12" font-weight="bold" text-anchor="middle" fill="white">amount</text>
  
  <rect x="460" y="120" width="120" height="30" fill="#3498db" stroke="#2980b9"/>
  <text x="520" y="140" font-size="12" font-weight="bold" text-anchor="middle" fill="white">status</text>
  
  <!-- USD Data Rows -->
  <rect x="70" y="150" width="120" height="25" fill="#e8f4fd" stroke="#bdc3c7"/>
  <text x="130" y="167" font-size="11" text-anchor="middle" fill="#2c3e50">USD</text>
  <rect x="190" y="150" width="150" height="25" fill="#e8f4fd" stroke="#bdc3c7"/>
  <text x="265" y="167" font-size="11" text-anchor="middle" fill="#2c3e50">09:00</text>
  <rect x="340" y="150" width="120" height="25" fill="#e8f4fd" stroke="#bdc3c7"/>
  <text x="400" y="167" font-size="11" text-anchor="middle" fill="#2c3e50">100.00</text>
  <rect x="460" y="150" width="120" height="25" fill="#e8f4fd" stroke="#bdc3c7"/>
  <text x="520" y="167" font-size="11" text-anchor="middle" fill="#2c3e50">paid</text>
  
  <rect x="70" y="175" width="120" height="25" fill="#e8f4fd" stroke="#bdc3c7"/>
  <text x="130" y="192" font-size="11" text-anchor="middle" fill="#2c3e50">USD</text>
  <rect x="190" y="175" width="150" height="25" fill="#e8f4fd" stroke="#bdc3c7"/>
  <text x="265" y="192" font-size="11" text-anchor="middle" fill="#2c3e50">10:15</text>
  <rect x="340" y="175" width="120" height="25" fill="#e8f4fd" stroke="#bdc3c7"/>
  <text x="400" y="192" font-size="11" text-anchor="middle" fill="#2c3e50">250.00</text>
  <rect x="460" y="175" width="120" height="25" fill="#e8f4fd" stroke="#bdc3c7"/>
  <text x="520" y="192" font-size="11" text-anchor="middle" fill="#2c3e50">paid</text>
  
  <rect x="70" y="200" width="120" height="25" fill="#e8f4fd" stroke="#bdc3c7"/>
  <text x="130" y="217" font-size="11" text-anchor="middle" fill="#2c3e50">USD</text>
  <rect x="190" y="200" width="150" height="25" fill="#e8f4fd" stroke="#bdc3c7"/>
  <text x="265" y="217" font-size="11" text-anchor="middle" fill="#2c3e50">11:30</text>
  <rect x="340" y="200" width="120" height="25" fill="#e8f4fd" stroke="#bdc3c7"/>
  <text x="400" y="217" font-size="11" text-anchor="middle" fill="#2c3e50">75.00</text>
  <rect x="460" y="200" width="120" height="25" fill="#e8f4fd" stroke="#bdc3c7"/>
  <text x="520" y="217" font-size="11" text-anchor="middle" fill="#2c3e50">paid</text>
  
  <!-- EUR Data Rows -->
  <rect x="70" y="240" width="120" height="25" fill="#fdf2e9" stroke="#bdc3c7"/>
  <text x="130" y="257" font-size="11" text-anchor="middle" fill="#2c3e50">EUR</text>
  <rect x="190" y="240" width="150" height="25" fill="#fdf2e9" stroke="#bdc3c7"/>
  <text x="265" y="257" font-size="11" text-anchor="middle" fill="#2c3e50">09:45</text>
  <rect x="340" y="240" width="120" height="25" fill="#fdf2e9" stroke="#bdc3c7"/>
  <text x="400" y="257" font-size="11" text-anchor="middle" fill="#2c3e50">120.00</text>
  <rect x="460" y="240" width="120" height="25" fill="#fdf2e9" stroke="#bdc3c7"/>
  <text x="520" y="257" font-size="11" text-anchor="middle" fill="#2c3e50">paid</text>
  
  <rect x="70" y="265" width="120" height="25" fill="#fdf2e9" stroke="#bdc3c7"/>
  <text x="130" y="282" font-size="11" text-anchor="middle" fill="#2c3e50">EUR</text>
  <rect x="190" y="265" width="150" height="25" fill="#fdf2e9" stroke="#bdc3c7"/>
  <text x="265" y="282" font-size="11" text-anchor="middle" fill="#2c3e50">12:00</text>
  <rect x="340" y="265" width="120" height="25" fill="#fdf2e9" stroke="#bdc3c7"/>
  <text x="400" y="282" font-size="11" text-anchor="middle" fill="#2c3e50">200.00</text>
  <rect x="460" y="265" width="120" height="25" fill="#fdf2e9" stroke="#bdc3c7"/>
  <text x="520" y="282" font-size="11" text-anchor="middle" fill="#2c3e50">paid</text>
  
  <rect x="70" y="290" width="120" height="25" fill="#fdf2e9" stroke="#bdc3c7"/>
  <text x="130" y="307" font-size="11" text-anchor="middle" fill="#2c3e50">EUR</text>
  <rect x="190" y="290" width="150" height="25" fill="#fdf2e9" stroke="#bdc3c7"/>
  <text x="265" y="307" font-size="11" text-anchor="middle" fill="#2c3e50">14:20</text>
  <rect x="340" y="290" width="120" height="25" fill="#fdf2e9" stroke="#bdc3c7"/>
  <text x="400" y="307" font-size="11" text-anchor="middle" fill="#2c3e50">80.00</text>
  <rect x="460" y="290" width="120" height="25" fill="#fdf2e9" stroke="#bdc3c7"/>
  <text x="520" y="307" font-size="11" text-anchor="middle" fill="#2c3e50">paid</text>
  
  <!-- Transform Arrow -->
  <path d="M 650 230 Q 700 230 750 230" stroke="#e74c3c" stroke-width="4" fill="none" marker-end="url(#arrowhead)"/>
  <text x="700" y="220" font-size="14" font-weight="bold" text-anchor="middle" fill="#e74c3c">TRANSFORM</text>
  
  <!-- Result Data Table -->
  <rect x="750" y="80" width="600" height="450" rx="8" fill="#ffffff" stroke="#34495e" stroke-width="2"/>
  <text x="1050" y="105" font-size="18" font-weight="bold" text-anchor="middle" fill="#2c3e50">Window Function Results</text>
  
  <!-- Result Headers -->
  <rect x="770" y="120" width="100" height="30" fill="#27ae60" stroke="#229954"/>
  <text x="820" y="140" font-size="11" font-weight="bold" text-anchor="middle" fill="white">currency</text>
  
  <rect x="870" y="120" width="90" height="30" fill="#27ae60" stroke="#229954"/>
  <text x="915" y="140" font-size="11" font-weight="bold" text-anchor="middle" fill="white">amount</text>
  
  <rect x="960" y="120" width="100" height="30" fill="#27ae60" stroke="#229954"/>
  <text x="1010" y="140" font-size="11" font-weight="bold" text-anchor="middle" fill="white">running_total</text>
  
  <rect x="1060" y="120" width="80" height="30" fill="#27ae60" stroke="#229954"/>
  <text x="1100" y="140" font-size="11" font-weight="bold" text-anchor="middle" fill="white">row_num</text>
  
  <rect x="1140" y="120" width="100" height="30" fill="#27ae60" stroke="#229954"/>
  <text x="1190" y="140" font-size="11" font-weight="bold" text-anchor="middle" fill="white">currency_avg</text>
  
  <rect x="1240" y="120" width="100" height="30" fill="#27ae60" stroke="#229954"/>
  <text x="1290" y="140" font-size="11" font-weight="bold" text-anchor="middle" fill="white">overall_avg</text>
  
  <!-- USD Result Rows -->
  <rect x="770" y="150" width="100" height="25" fill="#e8f4fd" stroke="#bdc3c7"/>
  <text x="820" y="167" font-size="11" text-anchor="middle" fill="#2c3e50">USD</text>
  <rect x="870" y="150" width="90" height="25" fill="#e8f4fd" stroke="#bdc3c7"/>
  <text x="915" y="167" font-size="11" text-anchor="middle" fill="#2c3e50">100.00</text>
  <rect x="960" y="150" width="100" height="25" fill="#ffe6e6" stroke="#bdc3c7"/>
  <text x="1010" y="167" font-size="11" text-anchor="middle" fill="#c0392b">100.00</text>
  <rect x="1060" y="150" width="80" height="25" fill="#e6f3ff" stroke="#bdc3c7"/>
  <text x="1100" y="167" font-size="11" text-anchor="middle" fill="#2980b9">1</text>
  <rect x="1140" y="150" width="100" height="25" fill="#f0fff0" stroke="#bdc3c7"/>
  <text x="1190" y="167" font-size="11" text-anchor="middle" fill="#27ae60">141.67</text>
  <rect x="1240" y="150" width="100" height="25" fill="#fff5e6" stroke="#bdc3c7"/>
  <text x="1290" y="167" font-size="11" text-anchor="middle" fill="#e67e22">154.17</text>
  
  <rect x="770" y="175" width="100" height="25" fill="#e8f4fd" stroke="#bdc3c7"/>
  <text x="820" y="192" font-size="11" text-anchor="middle" fill="#2c3e50">USD</text>
  <rect x="870" y="175" width="90" height="25" fill="#e8f4fd" stroke="#bdc3c7"/>
  <text x="915" y="192" font-size="11" text-anchor="middle" fill="#2c3e50">250.00</text>
  <rect x="960" y="175" width="100" height="25" fill="#ffe6e6" stroke="#bdc3c7"/>
  <text x="1010" y="192" font-size="11" text-anchor="middle" fill="#c0392b">350.00</text>
  <rect x="1060" y="175" width="80" height="25" fill="#e6f3ff" stroke="#bdc3c7"/>
  <text x="1100" y="192" font-size="11" text-anchor="middle" fill="#2980b9">2</text>
  <rect x="1140" y="175" width="100" height="25" fill="#f0fff0" stroke="#bdc3c7"/>
  <text x="1190" y="192" font-size="11" text-anchor="middle" fill="#27ae60">141.67</text>
  <rect x="1240" y="175" width="100" height="25" fill="#fff5e6" stroke="#bdc3c7"/>
  <text x="1290" y="192" font-size="11" text-anchor="middle" fill="#e67e22">154.17</text>
  
  <rect x="770" y="200" width="100" height="25" fill="#e8f4fd" stroke="#bdc3c7"/>
  <text x="820" y="217" font-size="11" text-anchor="middle" fill="#2c3e50">USD</text>
  <rect x="870" y="200" width="90" height="25" fill="#e8f4fd" stroke="#bdc3c7"/>
  <text x="915" y="217" font-size="11" text-anchor="middle" fill="#2c3e50">75.00</text>
  <rect x="960" y="200" width="100" height="25" fill="#ffe6e6" stroke="#bdc3c7"/>
  <text x="1010" y="217" font-size="11" text-anchor="middle" fill="#c0392b">425.00</text>
  <rect x="1060" y="200" width="80" height="25" fill="#e6f3ff" stroke="#bdc3c7"/>
  <text x="1100" y="217" font-size="11" text-anchor="middle" fill="#2980b9">3</text>
  <rect x="1140" y="200" width="100" height="25" fill="#f0fff0" stroke="#bdc3c7"/>
  <text x="1190" y="217" font-size="11" text-anchor="middle" fill="#27ae60">141.67</text>
  <rect x="1240" y="200" width="100" height="25" fill="#fff5e6" stroke="#bdc3c7"/>
  <text x="1290" y="217" font-size="11" text-anchor="middle" fill="#e67e22">154.17</text>
  
  <!-- Divider Line -->
  <line x1="770" y1="240" x2="1340" y2="240" stroke="#bdc3c7" stroke-width="2"/>
  
  <!-- EUR Result Rows -->
  <rect x="770" y="255" width="100" height="25" fill="#fdf2e9" stroke="#bdc3c7"/>
  <text x="820" y="272" font-size="11" text-anchor="middle" fill="#2c3e50">EUR</text>
  <rect x="870" y="255" width="90" height="25" fill="#fdf2e9" stroke="#bdc3c7"/>
  <text x="915" y="272" font-size="11" text-anchor="middle" fill="#2c3e50">120.00</text>
  <rect x="960" y="255" width="100" height="25" fill="#ffe6e6" stroke="#bdc3c7"/>
  <text x="1010" y="272" font-size="11" text-anchor="middle" fill="#c0392b">120.00</text>
  <rect x="1060" y="255" width="80" height="25" fill="#e6f3ff" stroke="#bdc3c7"/>
  <text x="1100" y="272" font-size="11" text-anchor="middle" fill="#2980b9">1</text>
  <rect x="1140" y="255" width="100" height="25" fill="#f0fff0" stroke="#bdc3c7"/>
  <text x="1190" y="272" font-size="11" text-anchor="middle" fill="#27ae60">133.33</text>
  <rect x="1240" y="255" width="100" height="25" fill="#fff5e6" stroke="#bdc3c7"/>
  <text x="1290" y="272" font-size="11" text-anchor="middle" fill="#e67e22">154.17</text>
  
  <rect x="770" y="280" width="100" height="25" fill="#fdf2e9" stroke="#bdc3c7"/>
  <text x="820" y="297" font-size="11" text-anchor="middle" fill="#2c3e50">EUR</text>
  <rect x="870" y="280" width="90" height="25" fill="#fdf2e9" stroke="#bdc3c7"/>
  <text x="915" y="297" font-size="11" text-anchor="middle" fill="#2c3e50">200.00</text>
  <rect x="960" y="280" width="100" height="25" fill="#ffe6e6" stroke="#bdc3c7"/>
  <text x="1010" y="297" font-size="11" text-anchor="middle" fill="#c0392b">320.00</text>
  <rect x="1060" y="280" width="80" height="25" fill="#e6f3ff" stroke="#bdc3c7"/>
  <text x="1100" y="297" font-size="11" text-anchor="middle" fill="#2980b9">2</text>
  <rect x="1140" y="280" width="100" height="25" fill="#f0fff0" stroke="#bdc3c7"/>
  <text x="1190" y="297" font-size="11" text-anchor="middle" fill="#27ae60">133.33</text>
  <rect x="1240" y="280" width="100" height="25" fill="#fff5e6" stroke="#bdc3c7"/>
  <text x="1290" y="297" font-size="11" text-anchor="middle" fill="#e67e22">154.17</text>
  
  <rect x="770" y="305" width="100" height="25" fill="#fdf2e9" stroke="#bdc3c7"/>
  <text x="820" y="322" font-size="11" text-anchor="middle" fill="#2c3e50">EUR</text>
  <rect x="870" y="305" width="90" height="25" fill="#fdf2e9" stroke="#bdc3c7"/>
  <text x="915" y="322" font-size="11" text-anchor="middle" fill="#2c3e50">80.00</text>
  <rect x="960" y="305" width="100" height="25" fill="#ffe6e6" stroke="#bdc3c7"/>
  <text x="1010" y="322" font-size="11" text-anchor="middle" fill="#c0392b">400.00</text>
  <rect x="1060" y="305" width="80" height="25" fill="#e6f3ff" stroke="#bdc3c7"/>
  <text x="1100" y="322" font-size="11" text-anchor="middle" fill="#2980b9">3</text>
  <rect x="1140" y="305" width="100" height="25" fill="#f0fff0" stroke="#bdc3c7"/>
  <text x="1190" y="322" font-size="11" text-anchor="middle" fill="#27ae60">133.33</text>
  <rect x="1240" y="305" width="100" height="25" fill="#fff5e6" stroke="#bdc3c7"/>
  <text x="1290" y="322" font-size="11" text-anchor="middle" fill="#e67e22">154.17</text>
  
  <!-- Partition Dividers with Labels -->
  <rect x="50" y="410" width="600" height="40" rx="8" fill="#3498db" opacity="0.1"/>
  <text x="100" y="435" font-size="14" font-weight="bold" fill="#2980b9">USD Partition</text>
  <text x="500" y="435" font-size="12" fill="#2980b9">Calculations done separately for each currency</text>
  
  <rect x="50" y="460" width="600" height="40" rx="8" fill="#e67e22" opacity="0.1"/>
  <text x="100" y="485" font-size="14" font-weight="bold" fill="#d35400">EUR Partition</text>
  <text x="500" y="485" font-size="12" fill="#d35400">Each partition maintains its own running totals &amp; row numbers</text>
  
  <!-- Legend -->
  <rect x="50" y="550" width="600" height="200" rx="8" fill="#f8f9fa" stroke="#bdc3c7"/>
  <text x="350" y="575" font-size="16" font-weight="bold" text-anchor="middle" fill="#2c3e50">Function Explanations</text>
  
  <rect x="70" y="590" width="20" height="20" fill="#ffe6e6"/>
  <text x="100" y="605" font-size="13" fill="#2c3e50"><tspan font-weight="bold">Running Total:</tspan> SUM() accumulates within each partition, ordered by time</text>
  
  <rect x="70" y="620" width="20" height="20" fill="#e6f3ff"/>
  <text x="100" y="635" font-size="13" fill="#2c3e50"><tspan font-weight="bold">Row Number:</tspan> ROW_NUMBER() assigns sequential numbers within each partition</text>
  
  <rect x="70" y="650" width="20" height="20" fill="#f0fff0"/>
  <text x="100" y="665" font-size="13" fill="#2c3e50"><tspan font-weight="bold">Currency Average:</tspan> AVG() calculated per partition (USD: 141.67, EUR: 133.33)</text>
  
  <rect x="70" y="680" width="20" height="20" fill="#fff5e6"/>
  <text x="100" y="695" font-size="13" fill="#2c3e50"><tspan font-weight="bold">Overall Average:</tspan> AVG() across all rows (no partition): 154.17</text>
  
  <text x="350" y="730" font-size="14" text-anchor="middle" fill="#7f8c8d">Notice how each currency partition maintains separate calculations</text>
  
  <!-- Arrow marker definition -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" 
            refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#e74c3c"/>
    </marker>
  </defs>
</svg>